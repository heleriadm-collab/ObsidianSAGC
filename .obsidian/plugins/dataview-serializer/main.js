/*
THIS IS A GENERATED/BUNDLED FILE BY BUN.
If you want to view the source, please visit the github repository of this plugin.
*/
var{defineProperty:M0,getOwnPropertyNames:K$,getOwnPropertyDescriptor:Z$}=Object,B$=Object.prototype.hasOwnProperty;var s0=new WeakMap,J$=($)=>{var H=s0.get($),X;if(H)return H;if(H=M0({},"__esModule",{value:!0}),$&&typeof $==="object"||typeof $==="function")K$($).map((K)=>!B$.call(H,K)&&M0(H,K,{get:()=>$[K],enumerable:!(X=Z$($,K))||X.enumerable}));return s0.set($,H),H};var W$=($,H)=>{for(var X in H)M0($,X,{get:H[X],enumerable:!0,configurable:!0,set:(K)=>H[X]=()=>K})};var e$={};W$(e$,{default:()=>$2});module.exports=J$(e$);var D=require("obsidian");var b5={foldersToScan:[],ignoredFolders:[],disableAutomaticUpdates:!1,showRefreshButton:!0,foldersToForceUpdate:[],showErrorNotifications:!0,debugLogging:!1,addTrailingNewline:!1,linkFormat:"shortest",enableDataviewJS:!0};var x=require("obsidian");var H1=Symbol.for("immer-nothing"),l0=Symbol.for("immer-draftable"),_=Symbol.for("immer-state"),Y$=[function($){return`The plugin for '${$}' has not been loaded into Immer. To enable the plugin, import and call \`enable${$}()\` when initializing your application.`},function($){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${$}'`},"This object has been frozen and should not be mutated",function($){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+$},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function($){return`'current' expects a draft, got: ${$}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function($){return`'original' expects a draft, got: ${$}`}];function E($,...H){{let X=Y$[$],K=e(X)?X.apply(null,H):X;throw Error(`[Immer] ${K}`)}throw Error(`[Immer] minified error nr: ${$}. Full error at: https://bit.ly/3cXEKWf`)}var v=Object,P5=v.getPrototypeOf,H0="constructor",B0="prototype",Q0="configurable",X0="enumerable",e5="writable",F5="value",i=($)=>!!$&&!!$[_];function o($){if(!$)return!1;return X1($)||J0($)||!!$[l0]||!!$[H0]?.[l0]||W0($)||Y0($)}var G$=v[B0][H0].toString(),r0=new WeakMap;function X1($){if(!$||!I0($))return!1;let H=P5($);if(H===null||H===v[B0])return!0;let X=v.hasOwnProperty.call(H,H0)&&H[H0];if(X===Object)return!0;if(!e(X))return!1;let K=r0.get(X);if(K===void 0)K=Function.toString.call(X),r0.set(X,K);return K===G$}function m5($,H,X=!0){if(L5($)===0)(X?Reflect.ownKeys($):v.keys($)).forEach((J)=>{H(J,$[J],$)});else $.forEach((K,J)=>H(J,K,$))}function L5($){let H=$[_];return H?H.type_:J0($)?1:W0($)?2:Y0($)?3:0}var i0=($,H,X=L5($))=>X===2?$.has(H):v[B0].hasOwnProperty.call($,H),k0=($,H,X=L5($))=>X===2?$.get(H):$[H],K0=($,H,X,K=L5($))=>{if(K===2)$.set(H,X);else if(K===3)$.add(X);else $[H]=X};function q$($,H){if($===H)return $!==0||1/$===1/H;else return $!==$&&H!==H}var J0=Array.isArray,W0=($)=>$ instanceof Map,Y0=($)=>$ instanceof Set,I0=($)=>typeof $==="object",e=($)=>typeof $==="function",N0=($)=>typeof $==="boolean";var u=($)=>$.copy_||$.base_;var h0=($)=>$.modified_?$.copy_:$.base_;function D0($,H){if(W0($))return new Map($);if(Y0($))return new Set($);if(J0($))return Array[B0].slice.call($);let X=X1($);if(H===!0||H==="class_only"&&!X){let K=v.getOwnPropertyDescriptors($);delete K[_];let J=Reflect.ownKeys(K);for(let Z=0;Z<J.length;Z++){let B=J[Z],W=K[B];if(W[e5]===!1)W[e5]=!0,W[Q0]=!0;if(W.get||W.set)K[B]={[Q0]:!0,[e5]:!0,[X0]:W[X0],[F5]:$[B]}}return v.create(P5($),K)}else{let K=P5($);if(K!==null&&X)return{...$};let J=v.create(K);return v.assign(J,$)}}function m0($,H=!1){if(G0($)||i($)||!o($))return $;if(L5($)>1)v.defineProperties($,{set:t5,add:t5,clear:t5,delete:t5});if(v.freeze($),H)m5($,(X,K)=>{m0(K,!0)},!1);return $}function j$(){E(2)}var t5={[F5]:j$};function G0($){if($===null||!I0($))return!0;return v.isFrozen($)}var Z0="MapSet",O0="Patches",K1={};function M5($){let H=K1[$];if(!H)E(0,$);return H}var z$=($)=>!!K1[$];var I5,Z1=()=>I5,U$=($,H)=>({drafts_:[],parent_:$,immer_:H,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:z$(Z0)?M5(Z0):void 0});function a0($,H){if(H)$.patchPlugin_=M5(O0),$.patches_=[],$.inversePatches_=[],$.patchListener_=H}function C0($){R0($),$.drafts_.forEach(V$),$.drafts_=null}function R0($){if($===I5)I5=$.parent_}var t0=($)=>I5=U$(I5,$);function V$($){let H=$[_];if(H.type_===0||H.type_===1)H.revoke_();else H.revoked_=!0}function e0($,H){H.unfinalizedDrafts_=H.drafts_.length;let X=H.drafts_[0];if($!==void 0&&$!==X){if(X[_].modified_)C0(H),E(4);if(o($))$=$1(H,$);let{patchPlugin_:J}=H;if(J)J.generateReplacementPatches_(X[_].base_,$,H)}else $=$1(H,X);if(P$(H,$,!0),C0(H),H.patches_)H.patchListener_(H.patches_,H.inversePatches_);return $!==H1?$:void 0}function $1($,H){if(G0(H))return H;let X=H[_];if(!X)return L0(H,$.handledSet_,$);if(!q0(X,$))return H;if(!X.modified_)return X.base_;if(!X.finalized_){let{callbacks_:K}=X;if(K)while(K.length>0)K.pop()($);W1(X,$)}return X.copy_}function P$($,H,X=!1){if(!$.parent_&&$.immer_.autoFreeze_&&$.canAutoFreeze_)m0(H,X)}function B1($){$.finalized_=!0,$.scope_.unfinalizedDrafts_--}var q0=($,H)=>$.scope_===H,M$=[];function J1($,H,X,K){let J=u($),Z=$.type_;if(K!==void 0){if(k0(J,K,Z)===H){K0(J,K,X,Z);return}}if(!$.draftLocations_){let W=$.draftLocations_=new Map;m5(J,(Y,G)=>{if(i(G)){let V=W.get(G)||[];V.push(Y),W.set(G,V)}})}let B=$.draftLocations_.get(H)??M$;for(let W of B)K0(J,W,X,Z)}function N$($,H,X){$.callbacks_.push(function(J){let Z=H;if(!Z||!q0(Z,J))return;J.mapSetPlugin_?.fixSetContents(Z);let B=h0(Z);J1($,Z.draft_??Z,B,X),W1(Z,J)})}function W1($,H){if($.modified_&&!$.finalized_&&($.type_===3||($.assigned_?.size??0)>0)){let{patchPlugin_:K}=H;if(K){let J=K.getPath($);if(J)K.generatePatches_($,J,H)}B1($)}}function w$($,H,X){let{scope_:K}=$;if(i(X)){let J=X[_];if(q0(J,K))J.callbacks_.push(function(){$0($);let B=h0(J);J1($,X,B,H)})}else if(o(X))$.callbacks_.push(function(){let Z=u($);if(k0(Z,H,$.type_)===X){if(K.drafts_.length>1&&($.assigned_.get(H)??!1)===!0&&$.copy_)L0(k0($.copy_,H,$.type_),K.handledSet_,K)}})}function L0($,H,X){if(!X.immer_.autoFreeze_&&X.unfinalizedDrafts_<1)return $;if(i($)||H.has($)||!o($)||G0($))return $;return H.add($),m5($,(K,J)=>{if(i(J)){let Z=J[_];if(q0(Z,X)){let B=h0(Z);K0($,K,B,$.type_),B1(Z)}}else if(o(J))L0(J,H,X)}),$}function Q$($,H){let X=J0($),K={type_:X?1:0,scope_:H?H.scope_:Z1(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:H,base_:$,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0},J=K,Z=T0;if(X)J=[K],Z=h5;let{revoke:B,proxy:W}=Proxy.revocable(J,Z);return K.draft_=W,K.revoke_=B,[W,K]}var T0={get($,H){if(H===_)return $;let X=u($);if(!i0(X,H,$.type_))return k$($,X,H);let K=X[H];if($.finalized_||!o(K))return K;if(K===w0($.base_,H)){$0($);let J=$.type_===1?+H:H,Z=F0($.scope_,K,$,J);return $.copy_[J]=Z}return K},has($,H){return H in u($)},ownKeys($){return Reflect.ownKeys(u($))},set($,H,X){let K=Y1(u($),H);if(K?.set)return K.set.call($.draft_,X),!0;if(!$.modified_){let J=w0(u($),H),Z=J?.[_];if(Z&&Z.base_===X)return $.copy_[H]=X,$.assigned_.set(H,!1),!0;if(q$(X,J)&&(X!==void 0||i0($.base_,H,$.type_)))return!0;$0($),b0($)}if($.copy_[H]===X&&(X!==void 0||(H in $.copy_))||Number.isNaN(X)&&Number.isNaN($.copy_[H]))return!0;return $.copy_[H]=X,$.assigned_.set(H,!0),w$($,H,X),!0},deleteProperty($,H){if($0($),w0($.base_,H)!==void 0||H in $.base_)$.assigned_.set(H,!1),b0($);else $.assigned_.delete(H);if($.copy_)delete $.copy_[H];return!0},getOwnPropertyDescriptor($,H){let X=u($),K=Reflect.getOwnPropertyDescriptor(X,H);if(!K)return K;return{[e5]:!0,[Q0]:$.type_!==1||H!=="length",[X0]:K[X0],[F5]:X[H]}},defineProperty(){E(11)},getPrototypeOf($){return P5($.base_)},setPrototypeOf(){E(12)}},h5={};m5(T0,($,H)=>{h5[$]=function(){let X=arguments;return X[0]=X[0][0],H.apply(this,X)}});h5.deleteProperty=function($,H){if(isNaN(parseInt(H)))E(13);return h5.set.call(this,$,H,void 0)};h5.set=function($,H,X){if(H!=="length"&&isNaN(parseInt(H)))E(14);return T0.set.call(this,$[0],H,X,$[0])};function w0($,H){let X=$[_];return(X?u(X):$)[H]}function k$($,H,X){let K=Y1(H,X);return K?F5 in K?K[F5]:K.get?.call($.draft_):void 0}function Y1($,H){if(!(H in $))return;let X=P5($);while(X){let K=Object.getOwnPropertyDescriptor(X,H);if(K)return K;X=P5(X)}return}function b0($){if(!$.modified_){if($.modified_=!0,$.parent_)b0($.parent_)}}function $0($){if(!$.copy_)$.assigned_=new Map,$.copy_=D0($.base_,$.scope_.immer_.useStrictShallowCopy_)}var D$=class{constructor($){if(this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(H,X,K)=>{if(e(H)&&!e(X)){let Z=X;X=H;let B=this;return function(Y=Z,...G){return B.produce(Y,(V)=>X.call(this,V,...G))}}if(!e(X))E(6);if(K!==void 0&&!e(K))E(7);let J;if(o(H)){let Z=t0(this),B=F0(Z,H,void 0),W=!0;try{J=X(B),W=!1}finally{if(W)C0(Z);else R0(Z)}return a0(Z,K),e0(J,Z)}else if(!H||!I0(H)){if(J=X(H),J===void 0)J=H;if(J===H1)J=void 0;if(this.autoFreeze_)m0(J,!0);if(K){let Z=[],B=[];M5(O0).generateReplacementPatches_(H,J,{patches_:Z,inversePatches_:B}),K(Z,B)}return J}else E(1,H)},this.produceWithPatches=(H,X)=>{if(e(H))return(B,...W)=>this.produceWithPatches(B,(Y)=>H(Y,...W));let K,J;return[this.produce(H,X,(B,W)=>{K=B,J=W}),K,J]},N0($?.autoFreeze))this.setAutoFreeze($.autoFreeze);if(N0($?.useStrictShallowCopy))this.setUseStrictShallowCopy($.useStrictShallowCopy);if(N0($?.useStrictIteration))this.setUseStrictIteration($.useStrictIteration)}createDraft($){if(!o($))E(8);if(i($))$=O$($);let H=t0(this),X=F0(H,$,void 0);return X[_].isManual_=!0,R0(H),X}finishDraft($,H){let X=$&&$[_];if(!X||!X.isManual_)E(9);let{scope_:K}=X;return a0(K,H),e0(void 0,K)}setAutoFreeze($){this.autoFreeze_=$}setUseStrictShallowCopy($){this.useStrictShallowCopy_=$}setUseStrictIteration($){this.useStrictIteration_=$}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches($,H){let X;for(X=H.length-1;X>=0;X--){let J=H[X];if(J.path.length===0&&J.op==="replace"){$=J.value;break}}if(X>-1)H=H.slice(X+1);let K=M5(O0).applyPatches_;if(i($))return K($,H);return this.produce($,(J)=>K(J,H))}};function F0($,H,X,K){let[J,Z]=W0(H)?M5(Z0).proxyMap_(H,X):Y0(H)?M5(Z0).proxySet_(H,X):Q$(H,X);if((X?.scope_??Z1()).drafts_.push(J),Z.callbacks_=X?.callbacks_??[],Z.key_=K,X&&K!==void 0)N$(X,Z,K);else Z.callbacks_.push(function(Y){Y.mapSetPlugin_?.fixSetContents(Z);let{patchPlugin_:G}=Y;if(Z.modified_&&G)G.generatePatches_(Z,[],Y)});return J}function O$($){if(!i($))E(10,$);return G1($)}function G1($){if(!o($)||G0($))return $;let H=$[_],X,K=!0;if(H){if(!H.modified_)return H.base_;H.finalized_=!0,X=D0($,H.scope_.immer_.useStrictShallowCopy_),K=H.scope_.immer_.shouldUseStrictIteration()}else X=D0($,!0);if(m5(X,(J,Z)=>{K0(X,J,G1(Z))},K),H)H.finalized_=!1;return X}var C$=new D$,y=C$.produce;var q1=($,H,X)=>{return X.indexOf($)===H};var j0=require("obsidian");class _0 extends j0.AbstractInputSuggest{inputEl;constructor($,H){super(H,$);this.inputEl=$}getSuggestions($){let H=this.app.vault.getAllLoadedFiles(),X=[],K=$.toLowerCase();return H.forEach((J)=>{if(J instanceof j0.TFolder&&J.path.toLowerCase().contains(K))X.push(J)}),X}renderSuggestion($,H){H.setText($.path)}selectSuggestion($){this.inputEl.value=$.path,this.close()}}var j1="Dataview Serializer";var F$=`${j1}:`,z1=!1,z0=($)=>{z1=$};var j=($,H,...X)=>{if(!z1&&(H==="debug"||H==="info"||H===void 0))return;let K=`${F$} ${$}`;switch(H){case"debug":console.debug(K,X);break;case"info":console.info(K,X);break;case"warn":console.warn(K,X);break;case"error":console.error(K,X);break;default:console.log(K,X)}};class y0 extends x.PluginSettingTab{plugin;constructor($,H){super($,H);this.plugin=H}display(){let{containerEl:$}=this;$.empty(),this.renderAutomaticUpdatesToggle(),this.renderRefreshButtonToggle(),this.renderDataviewJSToggle(),this.renderErrorNotificationsToggle(),this.renderTrailingNewlineToggle(),this.renderLinkFormatDropdown(),this.renderDebugLoggingToggle(),this.renderFoldersToScan(),this.renderFoldersToIgnore(),this.renderFoldersToForceUpdate(),this.renderSupportSection($)}renderAutomaticUpdatesToggle(){new x.Setting(this.containerEl).setName("Disable automatic updates").setDesc("When enabled, the plugin will not automatically serialize queries when files are created, modified, or renamed. You can still manually serialize queries using the command palette.").addToggle(($)=>{$.setValue(this.plugin.settings.disableAutomaticUpdates).onChange(async(H)=>{if(this.plugin.settings=y(this.plugin.settings,(X)=>{X.disableAutomaticUpdates=H}),await this.plugin.saveSettings(),H)this.plugin.unregisterEventHandlers();else this.plugin.setupEventHandlers()})})}renderRefreshButtonToggle(){new x.Setting(this.containerEl).setName("Show refresh button").setDesc("When enabled, a refresh button will be displayed next to each serialized Dataview query.").addToggle(($)=>{$.setValue(this.plugin.settings.showRefreshButton).onChange(async(H)=>{this.plugin.settings=y(this.plugin.settings,(X)=>{X.showRefreshButton=H}),await this.plugin.saveSettings()})})}renderDataviewJSToggle(){new x.Setting(this.containerEl).setName("Enable DataviewJS serialization").setDesc('When enabled, JavaScript-based Dataview queries can be serialized to static markdown. Note: JavaScript code cannot contain "--" due to HTML comment limitations.').addToggle(($)=>{$.setValue(this.plugin.settings.enableDataviewJS).onChange(async(H)=>{this.plugin.settings=y(this.plugin.settings,(X)=>{X.enableDataviewJS=H}),await this.plugin.saveSettings()})})}renderErrorNotificationsToggle(){new x.Setting(this.containerEl).setName("Show error notifications").setDesc("When enabled, a notification popup will be displayed when a query fails to serialize.").addToggle(($)=>{$.setValue(this.plugin.settings.showErrorNotifications).onChange(async(H)=>{this.plugin.settings=y(this.plugin.settings,(X)=>{X.showErrorNotifications=H}),await this.plugin.saveSettings()})})}renderTrailingNewlineToggle(){new x.Setting(this.containerEl).setName("Add trailing newline").setDesc("When enabled, an empty line will be added between the serialized content and the END marker. Useful for static site generators like Jekyll that require blank lines after tables or lists.").addToggle(($)=>{$.setValue(this.plugin.settings.addTrailingNewline).onChange(async(H)=>{this.plugin.settings=y(this.plugin.settings,(X)=>{X.addTrailingNewline=H}),await this.plugin.saveSettings()})})}renderLinkFormatDropdown(){new x.Setting(this.containerEl).setName("Link format").setDesc(`Format for internal links in serialized output. "Use Obsidian setting" respects your vault's "New link format" preference. "Shortest path" simplifies links when the filename is unique. "Absolute path" always uses the full path, which ensures consistency when syncing vaults across devices.`).addDropdown(($)=>{$.addOption("obsidian","Use Obsidian setting").addOption("shortest","Shortest path when possible").addOption("absolute","Absolute path").setValue(this.plugin.settings.linkFormat).onChange(async(H)=>{this.plugin.settings=y(this.plugin.settings,(X)=>{X.linkFormat=H}),await this.plugin.saveSettings()})})}renderDebugLoggingToggle(){new x.Setting(this.containerEl).setName("Debug logging").setDesc("When enabled, verbose debug messages will be logged to the console. Useful for troubleshooting.").addToggle(($)=>{$.setValue(this.plugin.settings.debugLogging).onChange(async(H)=>{this.plugin.settings=y(this.plugin.settings,(X)=>{X.debugLogging=H}),z0(H),await this.plugin.saveSettings()})})}renderSupportSection($){new x.Setting($).setName("Support").setHeading(),new x.Setting($).setName("Follow me on X").setDesc("SÃ©bastien Dubois (@dSebastien)").addButton((X)=>{X.setCta(),X.setButtonText("Follow me on X").onClick(()=>{window.open("https://x.com/dSebastien")})});let H=new DocumentFragment;H.createDiv({text:"Buy me a coffee to support the development of this plugin"}),new x.Setting($).setDesc(H),this.renderBuyMeACoffeeBadge($)}renderFoldersToScan(){this.doSearchAndRemoveList({currentList:this.plugin.settings.foldersToScan,setValue:async($)=>{this.plugin.settings=y(this.plugin.settings,(H)=>{H.foldersToScan=$})},name:"Folders to scan",description:"Folders to scan when looking for queries to serialize."})}renderFoldersToIgnore(){this.doSearchAndRemoveList({currentList:this.plugin.settings.ignoredFolders,setValue:async($)=>{this.plugin.settings=y(this.plugin.settings,(H)=>{H.ignoredFolders=$})},name:"Folders to ignore",description:"Folders to ignore when processing added/modified files."})}renderFoldersToForceUpdate(){this.doSearchAndRemoveList({currentList:this.plugin.settings.foldersToForceUpdate,setValue:async($)=>{this.plugin.settings=y(this.plugin.settings,(H)=>{H.foldersToForceUpdate=$})},name:"Folders to force update",description:"Folders containing files that should be updated when ANY file in the vault changes. Useful for index files with queries that aggregate data from elsewhere."})}doSearchAndRemoveList({currentList:$,setValue:H,description:X,name:K}){let J;new x.Setting(this.containerEl).setName(K).setDesc(X).addSearch((Z)=>{J=Z,new _0(Z.inputEl,this.app),Z.setPlaceholder("Example: folder1/folder2")}).addButton((Z)=>{Z.setIcon("plus"),Z.setTooltip("Add folder"),Z.onClick(async()=>{if(!J)return;let B=J.getValue();await H([...$,B].filter(q1)),await this.plugin.saveSettings(),J.setValue(""),this.display()})}),$.forEach((Z)=>new x.Setting(this.containerEl).setName(Z).addButton((B)=>B.setButtonText("Remove").onClick(async()=>{await H($.filter((W)=>W!==Z)),await this.plugin.saveSettings(),this.display()})))}renderBuyMeACoffeeBadge($,H=175){let K=$.createEl("a",{href:"https://www.buymeacoffee.com/dsebastien"}).createEl("img");K.src="https://github.com/dsebastien/obsidian-plugin-template/blob/main/src/assets/buy-me-a-coffee.png?raw=true",K.alt="Buy me a coffee",K.width=H}}var U1=($)=>{let H=typeof ExcalidrawAutomate>"u"?void 0:ExcalidrawAutomate;return H?H.isExcalidrawFile($):!1};var n=5000,V1="Canvas.md",T5="md",c="<!-- QueryToSerialize: ",$5="<!-- QueryToSerializeManual: ",H5="<!-- QueryToSerializeOnce: ",X5="<!-- QueryToSerializeOnceAndEject: ",q=" -->",K5="<!-- dataview-serializer-query: ",Z5="<!-- dataview-serializer-query-manual: ",B5="<!-- dataview-serializer-query-once: ",J5="<!-- dataview-serializer-query-once-and-eject: ",W5="<!-- SerializedQuery: ",N5="<!-- SerializedQuery END -->",Y5="<!-- dataview-serializer-result: ",w5="<!-- dataview-serializer-result-end -->",w2=new RegExp("<!-- SerializedQuery: [^\\n]* -->\\n([\\s\\S]*?)<!-- SerializedQuery END -->\\n","g"),Q2=new RegExp("<!-- dataview-serializer-result: [^\\n]* -->\\n([\\s\\S]*?)<!-- dataview-serializer-result-end -->\\n","g"),P1=5,x0=500,_5="<!-- IQ: ",y5="<!-- IQManual: ",x5="<!-- IQOnce: ",S5="<!-- IQOnceAndEject: ",f5=" -->",p="<!-- /IQ -->",A5="<!-- dataview-serializer-iq: ",E5="<!-- dataview-serializer-iq-manual: ",v5="<!-- dataview-serializer-iq-once: ",g5="<!-- dataview-serializer-iq-once-and-eject: ",d="<!-- /dataview-serializer-iq -->";var M1="table",N1="task",w1=["list","table","task"],c5="<!-- DataviewJSToSerialize:",p5="<!-- DataviewJSToSerializeManual:",d5="<!-- DataviewJSToSerializeOnce:",u5="<!-- DataviewJSToSerializeOnceAndEject:",o5="<!-- dataview-serializer-js:",n5="<!-- dataview-serializer-js-manual:",s5="<!-- dataview-serializer-js-once:",l5="<!-- dataview-serializer-js-once-and-eject:",a="<!-- SerializedDataviewJS",G5="<!-- SerializedDataviewJS END -->",t="<!-- dataview-serializer-js-result",q5="<!-- dataview-serializer-js-result-end -->",Q1=5000;function s($){let H=Object.prototype.toString.call($);if($ instanceof Date||typeof $==="object"&&H==="[object Date]")return new $.constructor(+$);else if(typeof $==="number"||H==="[object Number]"||typeof $==="string"||H==="[object String]")return new Date($);else return new Date(NaN)}function j5($,H){if($ instanceof Date)return new $.constructor(H);else return new Date(H)}function k1($,H){let X=s($);if(isNaN(H))return j5($,NaN);if(!H)return X;return X.setDate(X.getDate()+H),X}function D1($,H){let X=s($);if(isNaN(H))return j5($,NaN);if(!H)return X;let K=X.getDate(),J=j5($,X.getTime());J.setMonth(X.getMonth()+H+1,0);let Z=J.getDate();if(K>=Z)return J;else return X.setFullYear(J.getFullYear(),J.getMonth(),K),X}function O1($,H){let{years:X=0,months:K=0,weeks:J=0,days:Z=0,hours:B=0,minutes:W=0,seconds:Y=0}=H,G=s($),V=K||X?D1(G,K+X*12):G,N=Z||J?k1(V,Z+J*7):V,z=W+B*60,R=(Y+z*60)*1000;return j5($,N.getTime()+R)}function C1($,H){let X=s($),K=s(H);return+X<+K}var h1=require("obsidian");var R1=($)=>{return $.toLowerCase().trim().startsWith(N1)};var b1=/\[\[(.+?)\\?\|(.+?)\]\]/g,F1=/\[\[(.+?)\|(.+?)\]\]/g;function I1($){return $.split("/").pop()??$}function S0($){let H=$.lastIndexOf(".");if(H<=0)return $;return $.substring(0,H)}function I$($){if(!$)return $;return $.replace(/^(\s*-\s*)\[.\]\s*/gm,"$1")}var m1=async($)=>{let H=$.app.vault.getFiles(),X="shortest",K=$.linkFormat??"shortest";if(K==="obsidian"){let Y=$.app.vault.config?.newLinkFormat;if(Y==="relative"||Y==="absolute")X="absolute";else X="shortest"}else X=K;function J(W){if(X==="absolute")return!1;return H.filter((G)=>G.name==W).length<=1}function Z(W,Y){return S0(W)!==Y}let B="";try{if(B=await $.dataviewApi.tryQueryMarkdown($.query,$.originFile),R1($.query))B=I$(B);if($.query.toLocaleLowerCase().contains("table")){B=B.replaceAll("\\\\","\\").replaceAll(`
<`,"<"),b1.lastIndex=0;let W=[...B.matchAll(b1)];for(let Y of W){let G=Y[1],V=I1(G),N=Y[2];if(J(V))if(!Z(V,N))B=B.replace(Y[0],"[["+N+"]]");else if(V.endsWith(".md"))B=B.replace(Y[0],"[["+S0(V)+"\\|"+N+"]]");else B=B.replace(Y[0],"[["+V+"\\|"+N+"]]");else B=B.replace(Y[0],"[["+G+"\\|"+N+"]]")}}else{F1.lastIndex=0;let W=[...B.matchAll(F1)];for(let Y of W){let G=I1(Y[1]),V=Y[2];if(J(G))if(!Z(G,V))B=B.replace(Y[1]+"|","");else if(G.endsWith(".md"))B=B.replace(Y[1]+"|",S0(G)+"|");else B=B.replace(Y[1]+"|",G+"|")}}}catch(W){let Y=W instanceof Error?W.message:String(W);return j(`Failed to serialize query in file: ${$.originFile}`,"warn",W),new h1.Notice(`Dataview Serializer: Invalid query found in ${$.originFile}`),{success:!1,serializedContent:"",error:{message:Y,query:$.query}}}if($.indentation&&B)B=B.split(`
`).map((G)=>{return $.indentation+G}).join(`
`);return{success:!0,serializedContent:B}};var z5=($)=>{let H=!1,X=$.toLowerCase();for(let K of w1)if(X.startsWith(K))H=!0;return H};function h$($,H){let X=(K)=>{return H.includes(K)?K:K.trim()};if($.includes(J5.trim())||$.includes(J5))return{flagOpen:X(J5),updateMode:"once-and-eject",syntaxVariant:"alternative"};if($.includes(Z5.trim())||$.includes(Z5))return{flagOpen:X(Z5),updateMode:"manual",syntaxVariant:"alternative"};if($.includes(B5.trim())||$.includes(B5))return{flagOpen:X(B5),updateMode:"once",syntaxVariant:"alternative"};if($.includes(K5.trim())||$.includes(K5))return{flagOpen:X(K5),updateMode:"auto",syntaxVariant:"alternative"};if($.includes(X5.trim())||$.includes(X5))return{flagOpen:X(X5),updateMode:"once-and-eject",syntaxVariant:"legacy"};if($.includes($5.trim())||$.includes($5))return{flagOpen:X($5),updateMode:"manual",syntaxVariant:"legacy"};if($.includes(H5.trim())||$.includes(H5))return{flagOpen:X(H5),updateMode:"once",syntaxVariant:"legacy"};if($.includes(c.trim())||$.includes(c))return{flagOpen:X(c),updateMode:"auto",syntaxVariant:"legacy"};return null}function L1(){return{isCapturing:!1,startLineIndex:-1,flagOpen:"",updateMode:"auto",syntaxVariant:"legacy",indentation:"",accumulatedLines:[]}}function m$($,H){let X=$.join(`
`),K=X.indexOf(H),J=H.length;if(K===-1)K=X.indexOf(H.trim()),J=H.trim().length;if(K===-1)return"";let Z=X.indexOf(q);if(Z===-1)Z=X.indexOf(q.trim());if(Z===-1)return"";return X.substring(K+J,Z).split(`
`).map((W)=>W.trim()).join(" ").replace(/\s+/g," ").trim()}var T1=($)=>{let H=[],X=$.split(`
`),K=L1();for(let J=0;J<X.length;J++){let Z=X[J],B=Z.trim();if(K.isCapturing){if(K.accumulatedLines.push(Z),Z.includes(q)||Z.includes(q.trim())){let W=m$(K.accumulatedLines,K.flagOpen),Y=Z.includes(q)?q:q.trim();if(W&&!H.some((G)=>G.query===W)&&z5(W))H.push({query:W,indentation:K.indentation,updateMode:K.updateMode,flagOpen:K.flagOpen,flagClose:Y,originalQueryDefinition:K.accumulatedLines.join(`
`),syntaxVariant:K.syntaxVariant});K=L1()}}else{let W=h$(B,Z);if(W){let{flagOpen:Y,updateMode:G,syntaxVariant:V}=W;if(B.includes(q)||B.includes(q.trim())){let z=Z.substring(0,Z.indexOf(Y.trim())),O=B.indexOf(Y),R=Y.length;if(O===-1)O=B.indexOf(Y.trim()),R=Y.trim().length;let M=B.indexOf(q),U=q;if(M===-1)M=B.indexOf(q.trim()),U=Z.includes(q)?q:q.trim();let P=B.substring(O+R,M).trim();if(!H.some((Q)=>Q.query===P)&&z5(P))H.push({query:P,indentation:z,updateMode:G,flagOpen:Y,flagClose:U,syntaxVariant:V})}else K={isCapturing:!0,startLineIndex:J,flagOpen:Y,updateMode:G,syntaxVariant:V,indentation:Z.substring(0,Z.indexOf(Y.trim())),accumulatedLines:[Z]}}}}return H};function k($){return $.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var f0=($)=>{let H=!1;if($.toLowerCase().startsWith(M1))H=!0;return H};function U0($){let{updateMode:H,isManualTrigger:X,isAlreadySerialized:K}=$;if(X)return!1;if(H==="manual")return!0;if(H==="once"&&K)return!0;return!1}var S=require("@codemirror/view"),x1=require("@codemirror/state"),T=require("obsidian");function L$($){let H=$.indexOf(J5);if(H!==-1)return{flagOpen:J5,openIdx:H,queryType:"eject"};let X=$.indexOf(Z5);if(X!==-1)return{flagOpen:Z5,openIdx:X,queryType:"manual"};let K=$.indexOf(B5);if(K!==-1)return{flagOpen:B5,openIdx:K,queryType:"once"};let J=$.indexOf(K5);if(J!==-1)return{flagOpen:K5,openIdx:J,queryType:"auto"};let Z=$.indexOf(X5);if(Z!==-1)return{flagOpen:X5,openIdx:Z,queryType:"eject"};let B=$.indexOf($5);if(B!==-1)return{flagOpen:$5,openIdx:B,queryType:"manual"};let W=$.indexOf(H5);if(W!==-1)return{flagOpen:H5,openIdx:W,queryType:"once"};let Y=$.indexOf(c);if(Y!==-1)return{flagOpen:c,openIdx:Y,queryType:"auto"};return null}function T$($){let H=[],X=[{flag:g5,queryType:"eject",endMarker:d},{flag:E5,queryType:"manual",endMarker:d},{flag:v5,queryType:"once",endMarker:d},{flag:A5,queryType:"auto",endMarker:d},{flag:S5,queryType:"eject",endMarker:p},{flag:y5,queryType:"manual",endMarker:p},{flag:x5,queryType:"once",endMarker:p},{flag:_5,queryType:"auto",endMarker:p}];for(let{flag:J,queryType:Z,endMarker:B}of X){let W=0;while(!0){let Y=$.indexOf(J,W);if(Y===-1)break;let G=$.indexOf(f5,Y+J.length);if(G===-1){W=Y+1;continue}let V=$.indexOf(B,G);if(V===-1){W=Y+1;continue}let N=$.substring(Y+J.length,G).trim();if(!H.some((O)=>O.openIdx===Y&&O.flagOpen!==J)&&N)H.push({flagOpen:J,openIdx:Y,queryType:Z,expression:N,endIdx:V+B.length});W=V+B.length}}H.sort((J,Z)=>J.openIdx-Z.openIdx);let K=new Set;return H.filter((J)=>{if(K.has(J.openIdx))return!1;return K.add(J.openIdx),!0})}function _$($){let H=$.indexOf(l5);if(H!==-1)return{flagOpen:l5,openIdx:H,queryType:"eject"};let X=$.indexOf(n5);if(X!==-1)return{flagOpen:n5,openIdx:X,queryType:"manual"};let K=$.indexOf(s5);if(K!==-1)return{flagOpen:s5,openIdx:K,queryType:"once"};let J=$.indexOf(o5);if(J!==-1)return{flagOpen:o5,openIdx:J,queryType:"auto"};let Z=$.indexOf(u5);if(Z!==-1)return{flagOpen:u5,openIdx:Z,queryType:"eject"};let B=$.indexOf(p5);if(B!==-1)return{flagOpen:p5,openIdx:B,queryType:"manual"};let W=$.indexOf(d5);if(W!==-1)return{flagOpen:d5,openIdx:W,queryType:"once"};let Y=$.indexOf(c5);if(Y!==-1)return{flagOpen:c5,openIdx:Y,queryType:"auto"};return null}function S1($){switch($){case"auto":return{label:"auto",icon:"refresh-cw"};case"manual":return{label:"manual",icon:"hand"};case"once":return{label:"once",icon:"circle-1"};case"eject":return{label:"eject",icon:"log-out"}}}function y$($){let H=document.createElement("span");H.className=`dvs-query-badge dvs-query-badge-${$}`;let X=S1($),K=document.createElement("span");K.className="dvs-badge-icon",T.setIcon(K,X.icon);let J=document.createElement("span");return J.textContent=X.label,H.appendChild(K),H.appendChild(J),H}function x$($){let H=document.createElement("button");return H.className="dvs-refresh-button",H.setAttribute("aria-label","Refresh Dataview Query"),T.setIcon(H,"refresh-cw"),H.addEventListener("click",(X)=>{X.preventDefault(),X.stopPropagation(),$()}),H}var r5=S.Decoration.line({class:"dvs-query-line"}),_1=S.Decoration.line({class:"dvs-results-start-line"}),y1=S.Decoration.line({class:"dvs-results-end-line"}),S$=S.Decoration.mark({class:"dvs-inline-query"}),f1=($,H,X)=>S.ViewPlugin.fromClass(class{decorations;constructor(K){this.decorations=this.buildDecorations(K)}update(K){if(K.docChanged||K.viewportChanged)this.decorations=this.buildDecorations(K.view)}buildDecorations(K){let J=H(),Z=[];class B extends S.WidgetType{query;queryType;constructor(N,z){super();this.query=N;this.queryType=z}toDOM(N){let z=document.createElement("span");z.className="dvs-query-widgets";let O=y$(this.queryType);if(z.appendChild(O),J.showRefreshButton){let R=x$(async()=>{try{let M=$.workspace.getLeavesOfType("markdown").find((w)=>w.view instanceof T.MarkdownView&&w.view.contentEl.contains(N.dom));if(!(M?.view instanceof T.MarkdownView))return;let U=M.view.file;if(!U)return;let Q=(await X(U,!0,this.query,!0)).errors[0];if(Q){let w=Q.query.length>50?Q.query.substring(0,50)+"...":Q.query;new T.Notice(`Query failed:
"${w}"
${Q.message}`,n*2)}else new T.Notice("Dataview query serialized")}catch(M){console.error("Failed to refresh dataview query",M),new T.Notice("Failed to refresh dataview query")}});z.appendChild(R)}return z}}class W extends S.WidgetType{expression;queryType;constructor(N,z){super();this.expression=N;this.queryType=z}toDOM(N){let z=document.createElement("span");z.className="dvs-inline-query-widgets";let O=document.createElement("span");O.className=`dvs-inline-badge dvs-inline-badge-${this.queryType}`;let R=S1(this.queryType),M=document.createElement("span");if(M.className="dvs-inline-badge-icon",T.setIcon(M,R.icon),O.appendChild(M),z.appendChild(O),J.showRefreshButton){let U=document.createElement("button");U.className="dvs-inline-refresh-button",U.setAttribute("aria-label","Refresh Inline Query"),T.setIcon(U,"refresh-cw"),U.addEventListener("click",async(P)=>{P.preventDefault(),P.stopPropagation();try{let Q=$.workspace.getLeavesOfType("markdown").find((I)=>I.view instanceof T.MarkdownView&&I.view.contentEl.contains(N.dom));if(!(Q?.view instanceof T.MarkdownView))return;let w=Q.view.file;if(!w)return;let C=(await X(w,!0,this.expression,!0)).errors[0];if(C){let I=C.query.length>50?C.query.substring(0,50)+"...":C.query;new T.Notice(`Inline query failed:
"${I}"
${C.message}`,n*2)}else new T.Notice("Inline query serialized")}catch(Q){console.error("Failed to refresh inline query",Q),new T.Notice("Failed to refresh inline query")}}),z.appendChild(U)}return z}}let Y={isCapturing:!1,startLineNumber:-1,flagOpen:"",queryType:"auto",queryLines:[],lineNumbers:[],isDataviewJS:!1},G={isCapturing:!1,startLineNumber:-1,flagOpen:"",queryType:"auto",queryLines:[],lineNumbers:[],isDataviewJS:!0};for(let{from:N,to:z}of K.visibleRanges){let O=K.state.doc.lineAt(N),R=K.state.doc.lineAt(z);for(let M=O.number;M<=R.number;M++){let U=K.state.doc.line(M),P=U.text;if(Y.isCapturing){Y.queryLines.push(P),Y.lineNumbers.push(M),Z.push({from:U.from,to:U.from,decoration:r5});let w=P.indexOf(q),m=P.indexOf(q.trim()),C=w!==-1?w:m,I=w!==-1?q:q.trim();if(C!==-1){let b=Y.queryLines.join(`
`),{flagOpen:L}=Y,F=b.indexOf(L),g=L.length;if(F===-1)F=b.indexOf(L.trim()),g=L.trim().length;let h=b.indexOf(q);if(h===-1)h=b.indexOf(q.trim());if(F!==-1&&h!==-1){let A=b.substring(F+g,h).split(`
`).map((k5)=>k5.trim()).join(" ").replace(/\s+/g," ").trim(),i5=U.from+C+I.length;Z.push({from:i5,to:i5,decoration:S.Decoration.widget({widget:new B(A,Y.queryType),side:1})})}Y={isCapturing:!1,startLineNumber:-1,flagOpen:"",queryType:"auto",queryLines:[],lineNumbers:[]}}}else{let w=L$(P);if(w){let{flagOpen:m,openIdx:C,queryType:I}=w,b=P.indexOf(q,C),L=P.indexOf(q.trim(),C),F=b!==-1?b:L,g=b!==-1?q:q.trim();if(F!==-1){Z.push({from:U.from,to:U.from,decoration:r5});let h=P.substring(C+m.length,F).trim(),f=U.from+F+g.length;Z.push({from:f,to:f,decoration:S.Decoration.widget({widget:new B(h,I),side:1})})}else Y={isCapturing:!0,startLineNumber:M,flagOpen:m,queryType:I,queryLines:[P],lineNumbers:[M]},Z.push({from:U.from,to:U.from,decoration:r5})}}if(G.isCapturing){G.queryLines.push(P),G.lineNumbers.push(M),Z.push({from:U.from,to:U.from,decoration:r5});let w=P.indexOf(q),m=P.indexOf(q.trim()),C=w!==-1?w:m,I=w!==-1?q:q.trim();if(C!==-1){let b=G.queryLines.join(`
`),{flagOpen:L}=G,F=b.indexOf(L),g=L.length;if(F===-1)F=b.indexOf(L.trim()),g=L.trim().length;let h=b.indexOf(q);if(h===-1)h=b.indexOf(q.trim());if(F!==-1&&h!==-1){let f=b.substring(F+g,h).trim(),A=U.from+C+I.length;Z.push({from:A,to:A,decoration:S.Decoration.widget({widget:new B(f,G.queryType),side:1})})}G={isCapturing:!1,startLineNumber:-1,flagOpen:"",queryType:"auto",queryLines:[],lineNumbers:[],isDataviewJS:!0}}}else if(!Y.isCapturing&&J.enableDataviewJS){let w=_$(P);if(w){let{flagOpen:m,openIdx:C,queryType:I}=w,b=P.indexOf(q,C),L=P.indexOf(q.trim(),C),F=b!==-1?b:L,g=b!==-1?q:q.trim();if(Z.push({from:U.from,to:U.from,decoration:r5}),F!==-1){let h=P.substring(C+m.length,F).trim(),f=U.from+F+g.length;Z.push({from:f,to:f,decoration:S.Decoration.widget({widget:new B(h,I),side:1})})}else G={isCapturing:!0,startLineNumber:M,flagOpen:m,queryType:I,queryLines:[P],lineNumbers:[M],isDataviewJS:!0}}}if(!Y.isCapturing&&!G.isCapturing&&(P.includes(W5)||P.includes(Y5)))Z.push({from:U.from,to:U.from,decoration:_1});if(!Y.isCapturing&&!G.isCapturing&&(P.includes(N5)||P.includes(w5)))Z.push({from:U.from,to:U.from,decoration:y1});if(!Y.isCapturing&&!G.isCapturing&&(P.includes(a)||P.includes(t)))Z.push({from:U.from,to:U.from,decoration:_1});if(!Y.isCapturing&&!G.isCapturing&&(P.includes(G5)||P.includes(q5)))Z.push({from:U.from,to:U.from,decoration:y1});let Q=T$(P);for(let w of Q)Z.push({from:U.from+w.openIdx,to:U.from+w.endIdx,decoration:S$}),Z.push({from:U.from+w.endIdx,to:U.from+w.endIdx,decoration:S.Decoration.widget({widget:new W(w.expression,w.queryType),side:1})})}}Z.sort((N,z)=>N.from-z.from||N.to-z.to);let V=new x1.RangeSetBuilder;for(let{from:N,to:z,decoration:O}of Z)V.add(N,z,O);return V.finish()}},{decorations:(K)=>K.decorations});var f$=[{flag:g5,updateMode:"once-and-eject",syntaxVariant:"alternative",endMarker:d},{flag:E5,updateMode:"manual",syntaxVariant:"alternative",endMarker:d},{flag:v5,updateMode:"once",syntaxVariant:"alternative",endMarker:d},{flag:A5,updateMode:"auto",syntaxVariant:"alternative",endMarker:d},{flag:S5,updateMode:"once-and-eject",syntaxVariant:"legacy",endMarker:p},{flag:y5,updateMode:"manual",syntaxVariant:"legacy",endMarker:p},{flag:x5,updateMode:"once",syntaxVariant:"legacy",endMarker:p},{flag:_5,updateMode:"auto",syntaxVariant:"legacy",endMarker:p}];function A0($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var A$=f$.map(({flag:$,updateMode:H,syntaxVariant:X,endMarker:K})=>{let J=A0($),Z=A0(f5),B=A0(K);return{regex:new RegExp(`${J}(=[^-]*(?:-(?!->)[^-]*)*)${Z}([\\s\\S]*?)${B}`,"g"),updateMode:H,flag:$,syntaxVariant:X}});function E0($){let H=[];for(let{regex:K,flag:J,updateMode:Z,syntaxVariant:B}of A$){K.lastIndex=0;let W;while((W=K.exec($))!==null){let Y=W[1]?.trim()??"",G=W[2]??"";if(!Y)continue;let V=W.index;if(H.some((z)=>z.startOffset===V&&z.flagOpen!==J))continue;H.push({expression:Y,startOffset:V,endOffset:W.index+W[0].length,updateMode:Z,flagOpen:J,currentResult:G,fullMatch:W[0],syntaxVariant:B})}}H.sort((K,J)=>K.startOffset-J.startOffset);let X=new Set;return H.filter((K)=>{if(X.has(K.startOffset))return!1;return X.add(K.startOffset),!0})}function v0($,H,X="auto",K="legacy"){let J,Z;if(K==="alternative"){switch(X){case"manual":J=E5;break;case"once":J=v5;break;case"once-and-eject":J=g5;break;default:J=A5}Z=d}else{switch(X){case"manual":J=y5;break;case"once":J=x5;break;case"once-and-eject":J=S5;break;default:J=_5}Z=p}return`${J}${$}${f5}${H}${Z}`}function V0($,H="auto"){return v0($,"",H)}var A1=/^([ \t]*)```dataview\r?\n([\s\S]*?)\r?\n\1```/gm,E1=/`=\s*([^`]+)`/g;function E$($){let H=[];A1.lastIndex=0;let X;while((X=A1.exec($))!==null){let K=X[1]??"",J=X[2]?.trim()??"";if(J)H.push({query:J,startOffset:X.index,endOffset:X.index+X[0].length,indentation:K,type:"codeblock"})}return H}function v$($){let H=[];E1.lastIndex=0;let X;while((X=E1.exec($))!==null){let K=X[1]?.trim()??"";if(K){let J=X.index;while(J>0&&$[J-1]!==`
`)J--;let W=$.substring(J,X.index).match(/^([ \t]*)/)?.[1]??"";H.push({query:K,startOffset:X.index,endOffset:X.index+X[0].length,indentation:W,type:"inline"})}}return H}function g0($){let H=E$($),X=v$($);return[...H,...X].sort((K,J)=>K.startOffset-J.startOffset)}function c0($,H){let X=$.split(`
`).map((K)=>K.trim()).join(" ").replace(/\s+/g," ").trim();return`${H}${c}${X}${q}`}function g$($,H){let X=g0($);for(let K of X)if(H>=K.startOffset&&H<=K.endOffset)return K;return null}function v1($,H){let X=g$($,H);if(!X)return{converted:!1,newText:$,count:0,skipped:[]};if(X.type==="codeblock"&&!z5(X.query))return{converted:!1,newText:$,count:0,skipped:[X.query]};let K=X.type==="inline"?V0("="+X.query):c0(X.query,X.indentation);return{converted:!0,newText:$.substring(0,X.startOffset)+K+$.substring(X.endOffset),count:1,skipped:[]}}function g1($){let H=g0($);if(H.length===0)return{converted:!1,newText:$,count:0,skipped:[]};let X=$,K=0,J=[];for(let Z=H.length-1;Z>=0;Z--){let B=H[Z];if(B.type==="codeblock"&&!z5(B.query)){J.push(B.query);continue}let W=B.type==="inline"?V0("="+B.query):c0(B.query,B.indentation);X=X.substring(0,B.startOffset)+W+X.substring(B.endOffset),K++}return{converted:K>0,newText:X,count:K,skipped:J}}function c1($){let H=g0($);if(H.length===0)return{converted:!1,newText:$,count:0,skipped:[]};let X=$,K=0,J=[];for(let Z=H.length-1;Z>=0;Z--){let B=H[Z];if(B.type==="codeblock"&&!z5(B.query)){J.push(B.query);continue}let W=B.type==="inline"?V0("="+B.query):c0(B.query,B.indentation);X=X.substring(0,B.startOffset)+W+X.substring(B.endOffset),K++}return{converted:K>0,newText:X,count:K,skipped:J}}function p1($){return $!==null&&typeof $==="object"&&"path"in $&&"embed"in $&&typeof $.path==="string"&&typeof $.embed==="boolean"}function d1($){return $!==null&&typeof $==="object"&&"toISO"in $&&"toFormat"in $&&typeof $.toISO==="function"}function u1($){return $!==null&&typeof $==="object"&&"toISO"in $&&"toHuman"in $&&typeof $.toHuman==="function"&&!(("toFormat"in $)&&typeof $.toFormat==="function")}function o1($){return $!==null&&typeof $==="object"&&"$widget"in $&&"markdown"in $&&typeof $.markdown==="function"}function n1($){return $!==null&&typeof $==="object"&&"tagName"in $&&"innerHTML"in $}function c$($){return $!==null&&typeof $==="object"&&!Array.isArray($)&&!p1($)&&!d1($)&&!u1($)&&!o1($)&&!n1($)}function Q5($,H){if($===null||$===void 0)return"-";if(typeof $==="string")return $;if(typeof $==="number")return String($);if(typeof $==="boolean")return $?"true":"false";if(typeof $==="function")return"<function>";if(p1($))return p$($);if(d1($)){let X=$.toISO();if(X){if($.hour===0&&$.minute===0&&$.second===0)return $.toISODate()??X;return X}return"-"}if(u1($)){let X=$.toHuman();if(X)return X;return $.toISO()??"-"}if(o1($))return $.markdown();if(n1($))return $.textContent??"";if(Array.isArray($)){if($.length===0)return"-";return $.map((K)=>Q5(K,H)).join(", ")}if(c$($)){let X=Object.entries($);if(X.length===0)return"-";return`{ ${X.map(([J,Z])=>`${J}: ${Q5(Z,H)}`).join(", ")} }`}return String($)}function p$($){if(typeof $.toString==="function"){let K=$.toString();if(K&&K!=="[object Object]")return K}let H=$.embed?"!":"",X=$.path;if($.subpath){if($.type==="header")X+="#"+$.subpath;else if($.type==="block")X+="#^"+$.subpath}if($.display&&$.display!==$.path)return`${H}[[${X}|${$.display}]]`;return`${H}[[${X}]]`}function s1($){return $.replace(/\|/g,"\\|")}async function l1($){let{expression:H,originFile:X,dataviewApi:K,isTableCell:J=!1}=$,Z=H.startsWith("=")?H.slice(1).trim():H.trim();if(!Z)return{success:!1,serializedContent:"",error:{message:"Empty expression",expression:H}};try{let B=K.page(X,X);if(!B)B=K.page(X);if(!B&&X.endsWith(".md")){let N=X.slice(0,-3);if(B=K.page(N,X),!B)B=K.page(N)}if(!B)return j(`Could not get page metadata for ${X}`,"warn"),{success:!1,serializedContent:"",error:{message:`Could not get page metadata for file: ${X}`,expression:H}};let W={this:B},Y=K.evaluate(Z,W,X);if(!Y.successful)return{success:!1,serializedContent:"",error:{message:Y.error??"Unknown evaluation error",expression:H}};let G=Y.value,V=Q5(G,K);if(V==="")V="-";if(J)V=s1(V);return{success:!0,serializedContent:V}}catch(B){let W=B instanceof Error?B.message:String(B);return j(`Failed to evaluate inline expression: ${H}`,"warn",B),{success:!1,serializedContent:"",error:{message:W,expression:H}}}}function r1($,H){let X=H;while(X>0&&$[X-1]!==`
`)X--;let K=H;while(K<$.length&&$[K]!==`
`)K++;let Z=$.substring(X,K).trim();if(Z.startsWith("|")||Z.endsWith("|"))return!0;return(Z.match(/(?<!\\)\|/g)??[]).length>=2}async function P0($,H,X=5){let K=[];for(let J=0;J<$.length;J+=X){let Z=$.slice(J,J+X),B=await Promise.all(Z.map(H));K.push(...B)}return K}var d$=[{flag:l5,updateMode:"once-and-eject",syntaxVariant:"alternative"},{flag:n5,updateMode:"manual",syntaxVariant:"alternative"},{flag:s5,updateMode:"once",syntaxVariant:"alternative"},{flag:o5,updateMode:"auto",syntaxVariant:"alternative"},{flag:u5,updateMode:"once-and-eject",syntaxVariant:"legacy"},{flag:p5,updateMode:"manual",syntaxVariant:"legacy"},{flag:d5,updateMode:"once",syntaxVariant:"legacy"},{flag:c5,updateMode:"auto",syntaxVariant:"legacy"}];function u$($,H){let X=(K)=>{return H.includes(K)?K:K.trim()};for(let{flag:K,updateMode:J,syntaxVariant:Z}of d$)if($.includes(K.trim())||$.includes(K))return{flagOpen:X(K),updateMode:J,syntaxVariant:Z};return null}function i1(){return{isCapturing:!1,startLineIndex:-1,flagOpen:"",updateMode:"auto",syntaxVariant:"legacy",indentation:"",accumulatedLines:[]}}function o$($,H){let X=$.join(`
`),K=X.indexOf(H),J=H.length;if(K===-1)K=X.indexOf(H.trim()),J=H.trim().length;if(K===-1)return"";let Z=X.indexOf(q);if(Z===-1)Z=X.indexOf(q.trim());if(Z===-1)return"";return X.substring(K+J,Z).trim()}function a1($){let H=[],X=$.split(`
`),K=i1();for(let J=0;J<X.length;J++){let Z=X[J],B=Z.trim();if(K.isCapturing){if(K.accumulatedLines.push(Z),Z.includes(q)||Z.includes(q.trim())){let W=o$(K.accumulatedLines,K.flagOpen),Y=Z.includes(q)?q:q.trim();if(W){if(!H.some((V)=>V.jsCode===W))H.push({jsCode:W,indentation:K.indentation,updateMode:K.updateMode,flagOpen:K.flagOpen,flagClose:Y,syntaxVariant:K.syntaxVariant,originalQueryDefinition:K.accumulatedLines.join(`
`)})}K=i1()}}else{let W=u$(B,Z);if(W){let{flagOpen:Y,updateMode:G,syntaxVariant:V}=W,N=B.includes(q)||B.includes(q.trim()),z=Z.indexOf(Y.trim()),O=z>=0?Z.substring(0,z):"";if(N){let R=B.indexOf(Y),M=Y.length;if(R===-1)R=B.indexOf(Y.trim()),M=Y.trim().length;let U=B.indexOf(q),P=q;if(U===-1)U=B.indexOf(q.trim()),P=Z.includes(q)?q:q.trim();if(R!==-1&&U!==-1){let Q=B.substring(R+M,U).trim();if(Q&&!H.some((w)=>w.jsCode===Q))H.push({jsCode:Q,indentation:O,updateMode:G,flagOpen:Y,flagClose:P,syntaxVariant:V,originalQueryDefinition:Z})}}else K={isCapturing:!0,startLineIndex:J,flagOpen:Y,updateMode:G,syntaxVariant:V,indentation:O,accumulatedLines:[Z]}}}}return H}function n$($){return $!==null&&typeof $==="object"&&"path"in $&&"embed"in $&&typeof $.path==="string"&&typeof $.embed==="boolean"}function U5($,H){return Q5($,H)}function s$($,H){if(!$||$.length===0)return"";return $.map((K)=>{return`- ${U5(K,H)}`}).join(`
`)}function l$($,H,X){if(!$||$.length===0)return"";let K=`| ${$.join(" | ")} |`,J=`| ${$.map(()=>"---").join(" | ")} |`,Z=H.map((B)=>{return`| ${B.map((Y)=>{return U5(Y,X).replace(/\|/g,"\\|")}).join(" | ")} |`});return[K,J,...Z].join(`
`)}function r$($,H,X,K){let J=$.toLowerCase(),Z=H!==null&&H!==void 0?U5(H,K):"";switch(J){case"p":case"div":return Z;case"span":return Z;case"h1":return`# ${Z}`;case"h2":return`## ${Z}`;case"h3":return`### ${Z}`;case"h4":return`#### ${Z}`;case"h5":return`##### ${Z}`;case"h6":return`###### ${Z}`;case"b":case"strong":return`**${Z}**`;case"i":case"em":return`*${Z}*`;case"code":return`\`${Z}\``;case"s":case"strike":case"del":return`~~${Z}~~`;case"u":return Z;case"mark":return`==${Z}==`;case"sup":return`^${Z}^`;case"sub":return`~${Z}~`;case"a":if(X?.href)return`[${Z}](${X.href})`;return Z;case"img":if(X?.src)return`![${X?.alt??Z??""}](${X.src})`;return"";case"br":return`
`;case"hr":return"---";case"blockquote":return Z.split(`
`).map((B)=>`> ${B}`).join(`
`);case"pre":return`\`\`\`
${Z}
\`\`\``;case"li":return`- ${Z}`;case"ul":case"ol":return Z;case"table":case"thead":case"tbody":case"tr":case"th":case"td":return Z;default:return Z}}function i$($,H,X){if(!$||$.length===0)return"";let K=[];function J(Z,B){let W=Z.text??"";if(Z.link&&n$(Z.link)){let Y=U5(Z.link,X);W=W?`${Y}: ${W}`:Y}if(K.push(`${B}- ${W}`),Z.children&&Array.isArray(Z.children))for(let Y of Z.children)J(Y,B+"    ")}for(let Z of $)J(Z,"");return K.join(`
`)}function t1($,H){let X=[],K={load:(B,W)=>$.io.load(B,W),csv:(B,W)=>$.io.csv(B,W),normalize:(B,W)=>$.io.normalize(B,W)};return{proxy:{list:(B)=>{let W=Array.isArray(B)?B:B.values??[],Y=s$(W,$);if(Y)X.push({type:"list",content:Y})},table:(B,W)=>{let Y=Array.isArray(W)?W:W.values??[],G=l$(B,Y,$);if(G)X.push({type:"table",content:G})},taskList:(B,W=!1)=>{let Y=Array.isArray(B)?B:B.values??[],G=i$(Y,W,$);if(G)X.push({type:"taskList",content:G})},paragraph:(B)=>{let W=U5(B,$);if(W)X.push({type:"paragraph",content:W})},header:(B,W)=>{let Y=U5(W,$);if(Y){let G="#".repeat(Math.min(Math.max(B,1),6));X.push({type:"header",content:`${G} ${Y}`})}},span:(B)=>{let W=U5(B,$);if(W)X.push({type:"span",content:W})},el:(B,W,Y)=>{let G=r$(B,W,Y,$);if(G){let V=B.toLowerCase(),z=["p","div","h1","h2","h3","h4","h5","h6","blockquote","pre","hr","ul","ol","li"].includes(V)?"paragraph":"span";X.push({type:z,content:G})}},view:()=>{return Promise.reject(Error("dv.view() is not supported in serialized DataviewJS queries."))},executeJs:()=>{return Promise.reject(Error("dv.executeJs() is not supported in serialized DataviewJS queries."))},pages:(B)=>$.pages(B,H),pagePaths:(B)=>$.pagePaths(B,H),page:(B,W)=>$.page(B,W),current:()=>$.page(H),array:(B)=>$.array(B),isArray:(B)=>$.isArray(B),date:(B)=>$.date(B),duration:(B)=>$.duration(B),fileLink:(B,W,Y)=>$.fileLink(B,W,Y),sectionLink:(B,W,Y,G)=>$.sectionLink(B,W,Y,G),blockLink:(B,W,Y,G)=>$.blockLink(B,W,Y,G),compare:(B,W)=>$.compare(B,W),equal:(B,W)=>$.equal(B,W),clone:(B)=>$.clone(B),parse:(B)=>$.parse(B),luxon:$.luxon,io:K,func:$.func,value:$.value,widget:$.widget,evaluate:(B,W)=>$.evaluate(B,W,H),tryEvaluate:(B,W)=>$.tryEvaluate(B,W,H),query:(B,W)=>$.query(B,W??H),queryMarkdown:(B,W)=>$.queryMarkdown(B,W??H),tryQuery:(B,W)=>$.tryQuery(B,W??H),tryQueryMarkdown:(B,W)=>$.tryQueryMarkdown(B,W??H),markdownTable:(B,W)=>$.markdownTable(B,W),markdownList:(B)=>$.markdownList(B),markdownTaskList:(B)=>$.markdownTaskList(B),execute:async(B,W)=>{let Y=await $.queryMarkdown(B,W??H);if(Y)X.push({type:"paragraph",content:Y})}},getMarkdown:()=>{if(X.length===0)return"";return X.map((B)=>B.content).join(`

`)}}}async function a$($,H){return new Promise((X,K)=>{let J=setTimeout(()=>{K(Error(`DataviewJS execution timed out after ${H}ms`))},H);$().then((Z)=>{clearTimeout(J),X(Z)}).catch((Z)=>{clearTimeout(J),K(Z)})})}async function e1($){let{jsCode:H,originFile:X,dataviewApi:K,indentation:J}=$;if(!H||!H.trim())return{success:!1,serializedContent:"",error:{message:"Empty JavaScript code",jsCode:H}};try{let{proxy:Z,getMarkdown:B}=t1(K,X),Y=new(Object.getPrototypeOf(async function(){})).constructor("dv",H);await a$(async()=>{await Y(Z)},Q1);let G=B();if(J&&G)G=G.split(`
`).map((z)=>{return J+z}).join(`
`);return{success:!0,serializedContent:G}}catch(Z){let B=Z instanceof Error?Z.message:String(Z);return j(`Failed to execute DataviewJS in file: ${X}`,"warn",Z),{success:!1,serializedContent:"",error:{message:B,jsCode:H}}}}function t$($){return $.plugins?.plugins?.dataview?.api}var l=3;class p0 extends D.Plugin{settings=y(b5,()=>b5);dataviewApi;nextPossibleUpdates=new Map;recentlyUpdatedFiles=new Set;createEventRef=null;modifyEventRef=null;renameEventRef=null;filesToIgnoreFileEvents=new Set;scheduleUpdate=D.debounce(this.processRecentlyUpdatedFiles.bind(this),x0,!0);scheduleForcedUpdate=D.debounce(this.processForceUpdateFiles.bind(this),x0*20,!0);createQueryErrorNotice($,H){let X=H.split("/").pop()||H,K=$.query.length>50?$.query.substring(0,50)+"...":$.query,J=`Dataview Serializer: Query error in ${X}:
"${K}"
${$.message}`;new D.Notice(J,n*2)}async processRecentlyUpdatedFiles(){let $=[],H=[...this.recentlyUpdatedFiles];this.recentlyUpdatedFiles.clear();let X=await P0(H,(K)=>this.processFile(K),5);for(let K of X)for(let J of K.errors)$.push({filePath:K.filePath,error:J});if(this.settings.showErrorNotifications&&$.length>0){let K=$.slice(0,l);for(let{filePath:J,error:Z}of K)this.createQueryErrorNotice(Z,J);if($.length>l)new D.Notice(`${$.length-l} more query error(s) occurred. Check console for details.`,n)}}async processForceUpdateFiles(){if(!this.settings.foldersToForceUpdate||this.settings.foldersToForceUpdate.length===0)return;let $=this.app.vault.getMarkdownFiles().filter((K)=>{return this.settings.foldersToForceUpdate.some((J)=>K.path.startsWith(J))}),H=[],X=await P0($,(K)=>this.processFile(K),5);for(let K of X)for(let J of K.errors)H.push({filePath:K.filePath,error:J});if(this.settings.showErrorNotifications&&H.length>0){let K=H.slice(0,l);for(let{filePath:J,error:Z}of K)this.createQueryErrorNotice(Z,J);if(H.length>l)new D.Notice(`${H.length-l} more query error(s) occurred. Check console for details.`,n)}}async onload(){j("Initializing","debug"),this.app.workspace.onLayoutReady(()=>this.initializePlugin())}async initializePlugin(){if(this.dataviewApi=t$(this.app),!this.dataviewApi){j("The Dataview plugin is not installed or enabled. Please make sure it is installed and enabled, then restart Obsidian","error"),new D.Notice("The Dataview plugin is not installed or enabled. Please make sure it is installed and enabled, then restart Obsidian",n);return}if(await this.loadSettings(),!this.settings.disableAutomaticUpdates)this.setupEventHandlers();this.addSettingTab(new y0(this.app,this)),this.addCommand({id:"serialize-all-dataview-queries",name:"Scan and serialize all Dataview queries",callback:async()=>{j("Scanning and serializing all Dataview queries","debug");let $=this.app.vault.getMarkdownFiles(),H=[],X=await P0($,(K)=>this.processFile(K,!1,void 0,!0),5);for(let K of X)for(let J of K.errors)H.push({filePath:K.filePath,error:J});if(this.settings.showErrorNotifications&&H.length>0){let K=H.slice(0,l);for(let{filePath:J,error:Z}of K)this.createQueryErrorNotice(Z,J);if(H.length>l)new D.Notice(`${H.length-l} more query error(s) occurred. Check console for details.`,n)}}}),this.addCommand({id:"serialize-current-file-dataview-queries",name:"Scan and serialize Dataview queries in current file",callback:async()=>{let $=this.app.workspace.getActiveFile();if(!$){new D.Notice("No active file");return}if($.extension!==T5){new D.Notice("The active file is not a Markdown file");return}j(`Scanning and serializing Dataview queries in: ${$.path}`,"debug");let H=await this.processFile($,!0,void 0,!0);if(this.settings.showErrorNotifications&&H.errors.length>0)for(let X of H.errors)this.createQueryErrorNotice(X,H.filePath);else new D.Notice(`Dataview queries serialized in: ${$.name}`)}}),this.addCommand({id:"insert-dataview-serializer-block",name:"Insert Dataview serializer block",editorCallback:($)=>{let H=$.getCursor(),J=`${$.getLine(H.line).match(/^(\s*)/)?.[1]||""}${c}LIST FROM #foo ${q}`;$.replaceRange(J,H);let Z=J.indexOf("LIST FROM #foo"),B={line:H.line,ch:H.ch+Z},W={line:H.line,ch:H.ch+Z+14};$.setSelection(B,W),new D.Notice('Dataview serializer block inserted. Replace "LIST FROM #foo" with your query.')}}),this.addCommand({id:"convert-dataview-query-at-cursor",name:"Convert Dataview query at cursor to serialized format",editorCallback:async($)=>{let H=this.app.workspace.getActiveFile();if(!H){new D.Notice("No active file");return}if(H.extension!==T5){new D.Notice("The active file is not a Markdown file");return}let X=$.getValue(),K=$.getSelection();if(K&&K.length>0){let J=c1(K);if(!J.converted){if(J.skipped.length>0)new D.Notice(`No supported Dataview queries found in selection. Skipped unsupported queries: ${J.skipped.join(", ")}`);else new D.Notice("No Dataview queries found in selection");return}if($.replaceSelection(J.newText),J.skipped.length>0)new D.Notice(`Converted ${J.count} query(ies). Skipped unsupported: ${J.skipped.join(", ")}`);else new D.Notice(`Converted ${J.count} Dataview query(ies) to serialized format`)}else{let J=$.getCursor(),Z=0;for(let W=0;W<J.line;W++)Z+=$.getLine(W).length+1;Z+=J.ch;let B=v1(X,Z);if(!B.converted){if(B.skipped.length>0)new D.Notice(`No supported Dataview query at cursor. Skipped unsupported query: ${B.skipped[0]}`);else new D.Notice("No Dataview query found at cursor. Place cursor inside a ```dataview block or inline query.");return}$.setValue(B.newText),new D.Notice("Converted Dataview query to serialized format")}}}),this.addCommand({id:"convert-all-dataview-queries-in-file",name:"Convert all Dataview queries in current file to serialized format",editorCallback:async($)=>{let H=this.app.workspace.getActiveFile();if(!H){new D.Notice("No active file");return}if(H.extension!==T5){new D.Notice("The active file is not a Markdown file");return}let X=$.getValue(),K=g1(X);if(!K.converted){if(K.skipped.length>0)new D.Notice(`No supported Dataview queries found. Skipped unsupported queries: ${K.skipped.join(", ")}`);else new D.Notice("No Dataview queries found in the current file");return}if($.setValue(K.newText),K.skipped.length>0)new D.Notice(`Converted ${K.count} query(ies). Skipped unsupported: ${K.skipped.join(", ")}`);else new D.Notice(`Converted ${K.count} Dataview query(ies) to serialized format`)}}),this.registerEditorExtension(f1(this.app,()=>this.settings,this.processFile.bind(this)))}onunload(){}async loadSettings(){j("Loading settings","debug");let $=await this.loadData();if(!$)j("Using default settings","debug"),$=y(b5,()=>b5);let H=!1;if(this.settings=y(this.settings,(X)=>{if($.foldersToScan!==void 0&&$.foldersToScan!==null&&Array.isArray($.foldersToScan))X.foldersToScan=$.foldersToScan;else j("The loaded settings miss the [foldersToScan] property","debug"),H=!0;if($.ignoredFolders!==void 0&&$.ignoredFolders!==null&&Array.isArray($.ignoredFolders))X.ignoredFolders=$.ignoredFolders;else j("The loaded settings miss the [ignoredFolders] property","debug"),H=!0;if($.disableAutomaticUpdates!==void 0&&$.disableAutomaticUpdates!==null&&typeof $.disableAutomaticUpdates==="boolean")X.disableAutomaticUpdates=$.disableAutomaticUpdates;else j("The loaded settings miss the [disableAutomaticUpdates] property","debug"),H=!0;if($.showRefreshButton!==void 0&&$.showRefreshButton!==null&&typeof $.showRefreshButton==="boolean")X.showRefreshButton=$.showRefreshButton;else j("The loaded settings miss the [showRefreshButton] property","debug"),H=!0;if($.foldersToForceUpdate!==void 0&&$.foldersToForceUpdate!==null&&Array.isArray($.foldersToForceUpdate))X.foldersToForceUpdate=$.foldersToForceUpdate;else j("The loaded settings miss the [foldersToForceUpdate] property","debug"),H=!0;if($.showErrorNotifications!==void 0&&$.showErrorNotifications!==null&&typeof $.showErrorNotifications==="boolean")X.showErrorNotifications=$.showErrorNotifications;else j("The loaded settings miss the [showErrorNotifications] property","debug"),H=!0;if($.debugLogging!==void 0&&$.debugLogging!==null&&typeof $.debugLogging==="boolean")X.debugLogging=$.debugLogging;else j("The loaded settings miss the [debugLogging] property","debug"),H=!0;if($.addTrailingNewline!==void 0&&$.addTrailingNewline!==null&&typeof $.addTrailingNewline==="boolean")X.addTrailingNewline=$.addTrailingNewline;else j("The loaded settings miss the [addTrailingNewline] property","debug"),H=!0;if($.linkFormat!==void 0&&$.linkFormat!==null&&($.linkFormat==="obsidian"||$.linkFormat==="shortest"||$.linkFormat==="absolute"))X.linkFormat=$.linkFormat;else j("The loaded settings miss the [linkFormat] property","debug"),H=!0;if($.enableDataviewJS!==void 0&&$.enableDataviewJS!==null&&typeof $.enableDataviewJS==="boolean")X.enableDataviewJS=$.enableDataviewJS;else j("The loaded settings miss the [enableDataviewJS] property","debug"),H=!0}),z0(this.settings.debugLogging),j("Settings loaded","debug",$),H)this.saveSettings()}async saveSettings(){j("Saving settings","debug"),await this.saveData(this.settings),j("Settings saved","debug",this.settings)}setupEventHandlers(){if(this.createEventRef||this.modifyEventRef||this.renameEventRef){j("Event handlers already registered, skipping setup","debug");return}this.app.workspace.onLayoutReady(async()=>{this.createEventRef=this.app.vault.on("create",($)=>{this.recentlyUpdatedFiles.add($),this.scheduleUpdate(),this.scheduleForcedUpdate()}),this.registerEvent(this.createEventRef),this.renameEventRef=this.app.vault.on("rename",($)=>{this.recentlyUpdatedFiles.add($),this.scheduleUpdate(),this.scheduleForcedUpdate()}),this.registerEvent(this.renameEventRef),this.modifyEventRef=this.app.vault.on("modify",($)=>{if($ instanceof D.TFile&&this.filesToIgnoreFileEvents.has($.path)){j(`Ignoring modify event for ${$.path} as it was triggered by the plugin itself`,"debug"),this.filesToIgnoreFileEvents.delete($.path);return}this.recentlyUpdatedFiles.add($),this.scheduleUpdate(),this.scheduleForcedUpdate()}),this.registerEvent(this.modifyEventRef),j("Event handlers registered for automatic updates","debug")})}unregisterEventHandlers(){if(this.createEventRef)this.app.vault.offref(this.createEventRef),this.createEventRef=null;if(this.modifyEventRef)this.app.vault.offref(this.modifyEventRef),this.modifyEventRef=null;if(this.renameEventRef)this.app.vault.offref(this.renameEventRef),this.renameEventRef=null;j("Event handlers unregistered for automatic updates","debug")}async processFile($,H=!1,X,K=!1){let J={filePath:"",errors:[]};if(!($ instanceof D.TFile))return J;let Z=$,B={filePath:Z.path,errors:[]};if(await this.shouldFileBeIgnored(Z,H))return B;try{let Y=await this.app.vault.cachedRead(Z),G=T1(Y),V=E0(Y),N=this.settings.enableDataviewJS?a1(Y):[];if(G.length===0&&V.length===0&&N.length===0)return B;let z=`${Y}`;j(`[DEBUG] Processing ${G.length} queries in file [${Z.path}]`,"debug");for(let R of G){let{query:M,updateMode:U,flagOpen:P,flagClose:Q,syntaxVariant:w}=R,m=w==="alternative"?Y5:W5,C=w==="alternative"?w5:N5;if(j(`[DEBUG] Query: "${M}", mode: ${U}, flagOpen: "${P}", flagClose: "${Q}", syntaxVariant: ${w}`,"debug"),X&&M!==X)continue;let I=k(P),b=k(M),L=k(Q),F=new RegExp(`${I}${b}\\s*${L}\\n(?:${k(W5)}|${k(Y5)})[^\\n]*${k(q)}`,"m"),g=!!Y.match(F);if(j(`[DEBUG] isAlreadySerialized: ${g}`,"debug"),U0({updateMode:U,isManualTrigger:K,isAlreadySerialized:g})){j("[DEBUG] Skipping query due to shouldSkipQuery","debug");continue}let h=R.indentation;j(`Processing query: [${M}] in file [${Z.path}]`,"debug");let f=await m1({query:M,originFile:Z.path,dataviewApi:this.dataviewApi,app:this.app,indentation:h,linkFormat:this.settings.linkFormat});if(!f.success&&f.error){j(`[DEBUG] Serialization error: ${f.error.message}`,"debug"),B.errors.push(f.error);continue}let A=f.serializedContent;j(`[DEBUG] Serialized content length: ${A.length}, content: "${A.substring(0,100)}..."`,"debug");let i5=new RegExp(`${I}${b}\\s*${L}\\n(?:${k(W5)}|${k(Y5)})[^\\n]*${k(q)}\\n([\\s\\S]*?)(?:${k(N5)}|${k(w5)})`,"m"),k5=Y.match(i5);if(j(`[DEBUG] Idempotency check - existingMatch found: ${!!k5}`,"debug"),k5){let D5=k5[1]?.trim()??"",O5=A.trim();if(j(`[DEBUG] Idempotency - existing length: ${D5.length}, new length: ${O5.length}, match: ${D5===O5}`,"debug"),D5===O5){j(`Skipping query in [${Z.path}] - content unchanged: "${M}"`,"debug");continue}}if(A!==""){let D5=k(M),O5=k(h),$$=k(P),d0=`(?:${k(W5)}|${k(Y5)})`,u0=`(?:${k(N5)}|${k(w5)})`,H$=k(Q),o0=k(q),C5,V5=R.originalQueryDefinition;if(j(`[DEBUG] Is multi-line query: ${!!V5}, indentation: "${h}"`,"debug"),V5){let X$=k(V5);C5=new RegExp(`(${X$}\\n)(?:${d0}[^\\n]*${o0}\\n[\\s\\S]*?${u0}\\n)?`,"gm")}else C5=new RegExp(`^(${O5}${$$}${D5}\\s*${H$}\\n)(?:${d0}[^\\n]*${o0}\\n[\\s\\S]*?${u0}\\n)?`,"gm");j(`[DEBUG] Replacement regex: ${C5.source}`,"debug");let R5=z.match(C5);if(j(`[DEBUG] Regex test - matches: ${R5?R5.length:0}, matched text length: ${R5?.[0]?.length??0}`,"debug"),R5)j(`[DEBUG] Matched text (first 200 chars): "${R5[0]?.substring(0,200)}"`,"debug");let r="",a5=h.length>0||this.settings.addTrailingNewline;if(U==="once-and-eject")r=`${A}
`;else if(V5)if(f0(M))r=`${V5}
${m}${M}${q}

${A}
${a5?`
`:""}${C}
`;else r=`${V5}
${m}${M}${q}
${A}
${a5?`
`:""}${C}
`;else if(f0(M))r=`${h}${P}${M}${Q}
${m}${M}${q}

${A}
${a5?`
`:""}${C}
`;else r=`${h}${P}${M}${Q}
${m}${M}${q}
${A}
${a5?`
`:""}${C}
`;j(`[DEBUG] Replacement string length: ${r.length}, first 200 chars: "${r.substring(0,200)}"`,"debug");let n0=z.length;z=z.replace(C5,r),j(`[DEBUG] After replacement - text length before: ${n0}, after: ${z.length}, diff: ${z.length-n0}`,"debug")}}if(z=await this.processInlineQueries(z,Y,Z.path,B,X,K),this.settings.enableDataviewJS&&N.length>0)z=await this.processDataviewJSQueries(z,Y,Z.path,B,N,X,K);let O=O1(new Date,{seconds:P1});if(this.nextPossibleUpdates.set(Z.path,O),j(`[DEBUG] Final check - original length: ${Y.length}, updated length: ${z.length}, will save: ${z!==Y}`,"debug"),z!==Y){if(X)this.filesToIgnoreFileEvents.add(Z.path),window.setTimeout(()=>{if(this.filesToIgnoreFileEvents.has(Z.path))this.filesToIgnoreFileEvents.delete(Z.path)},2000);await this.app.vault.modify(Z,z)}}catch(Y){if(this.filesToIgnoreFileEvents.has(Z.path))this.filesToIgnoreFileEvents.delete(Z.path);j("Failed to process the file","warn",Y)}return B}async processInlineQueries($,H,X,K,J,Z=!1){let B=E0($);if(B.length===0)return $;let W=[...B].sort((Y,G)=>G.startOffset-Y.startOffset);for(let Y of W){let{expression:G,updateMode:V,currentResult:N,fullMatch:z,startOffset:O,syntaxVariant:R}=Y;if(J&&G!==J)continue;if(U0({updateMode:V,isManualTrigger:Z,isAlreadySerialized:N!==void 0&&N!==""}))continue;let U=r1($,O),P=await l1({expression:G,originFile:X,dataviewApi:this.dataviewApi,isTableCell:U});if(!P.success&&P.error){K.errors.push({message:P.error.message,query:G});continue}let Q=P.serializedContent;if(N!==void 0){let m=N.trim(),C=Q.trim();if(m===C){j(`Skipping inline query in [${X}] - content unchanged: "${G}"`,"debug");continue}}let w;if(V==="once-and-eject")w=Q;else w=v0(G,Q,V,R);$=$.substring(0,O)+w+$.substring(O+z.length)}return $}async processDataviewJSQueries($,H,X,K,J,Z,B=!1){j(`[DEBUG] Processing ${J.length} DataviewJS queries in file [${X}]`,"debug");for(let W of J){let{jsCode:Y,updateMode:G,indentation:V,syntaxVariant:N,originalQueryDefinition:z}=W;if(Z&&Y!==Z)continue;let O=N==="alternative"?t:a,R=N==="alternative"?q5:G5,M=H.indexOf(z),U=M!==-1?H.substring(M+z.length):"",P=U.trimStart().startsWith(O.trim())||U.trimStart().startsWith(a.trim())||U.trimStart().startsWith(t.trim());if(j(`[DEBUG] DataviewJS: isAlreadySerialized: ${P}, mode: ${G}`,"debug"),U0({updateMode:G,isManualTrigger:B,isAlreadySerialized:P})){j("[DEBUG] Skipping DataviewJS query due to shouldSkipQuery","debug");continue}j(`Processing DataviewJS query in file [${X}]`,"debug");let Q=await e1({jsCode:Y,originFile:X,dataviewApi:this.dataviewApi,indentation:V});if(!Q.success&&Q.error){j(`[DEBUG] DataviewJS serialization error: ${Q.error.message}`,"debug"),K.errors.push({message:Q.error.message,query:Y.substring(0,50)+(Y.length>50?"...":"")});continue}let w=Q.serializedContent,m=new RegExp(`${k(z)}\\n(?:${k(a)}|${k(t)})${k(q)}\\n([\\s\\S]*?)(?:${k(G5)}|${k(q5)})`,"m"),C=H.match(m);if(C){let I=C[1]?.trim()??"",b=w.trim();if(I===b){j(`Skipping DataviewJS query in [${X}] - content unchanged`,"debug");continue}}if(w!==""||G==="once-and-eject"){let I=k(z),b=new RegExp(`(${I}\\n)(?:(?:${k(a)}|${k(t)})${k(q)}\\n[\\s\\S]*?(?:${k(G5)}|${k(q5)})\\n)?`,"gm"),L=V.length>0||this.settings.addTrailingNewline,F;if(G==="once-and-eject")F=`${w}
`;else F=`${z}
${O}${q}
${w}
${L?`
`:""}${R}
`;$=$.replace(b,F)}}return $}async shouldFileBeIgnored($,H=!1){if(!$.path)return!0;if(T5!==$.extension)return!0;if(V1===$.name)return!0;if((await this.app.vault.read($)).trim().length===0)return!0;if(U1($))return!0;if(H)return!1;if(this.nextPossibleUpdates.has($.path)){let K=this.nextPossibleUpdates.get($.path);if(C1($.stat.mtime,K))return j("File has been updated recently. Ignoring","debug",$.path),!0;else j("File has not been updated recently. Processing","debug",$.path)}return this.settings.ignoredFolders.some((K)=>{if($.path.startsWith(K))return!0;else return!1})}}var $2=p0;

/* nosourcemap */